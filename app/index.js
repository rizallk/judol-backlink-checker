import _0x6338e4 from'puppeteer';import{existsSync,readFileSync,writeFileSync}from'fs';import{createInterface}from'readline';import{wait}from'../utils/wait.js';import _0x7b7fdd from'../utils/randomNumber.js';import{chromeVersions}from'../utils/chromeVersions.js';import{join,dirname}from'path';import{fileURLToPath}from'url';import _0xdce29b from'../utils/getRandomIndex.js';import _0x16f6ca from'../utils/createExcel.js';import{config}from'./config.js';const welcomeText='\x0a\x20\x20|=============================================|\x0a\x20\x20|\x20\x20Judol\x20Checker\x20by\x20Rizal\x20K.\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20|\x0a\x20\x20|\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20|\x0a\x20\x20|\x20\x20github\x20:\x20github.com/rizallk\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20|\x0a\x20\x20|\x20\x20support\x20:\x20trakteer.id/rizall-kadamong/tip\x20\x20|\x0a\x20\x20|\x20\x20me\x20:\x20rizallk.vercel.app\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20|\x0a\x20\x20|=============================================|\x0a';console['log'](welcomeText);(!config['chromeProfileDir']['length']||!config['executablePath']['length']||!config['userDataDir']['length'])&&(console['error']('[Required]\x20chromeProfileDir,\x20executablePath\x20dan\x20userDataDir\x20wajib\x20diisi!'),console['log']('[Message]\x20Pastikan\x20Anda\x20mengisi\x20beberapa\x20hal\x20tersebut\x20di\x20file\x20config.js'),process['exit'](0x0));const judolKeywordsPath=join(dirname(fileURLToPath(import.meta['url'])),'judol_keywords.txt');!existsSync(judolKeywordsPath)&&(console['error']('[Required]\x20File\x20judol_keywords.txt\x20tidak\x20ditemukan!'),console['log']('[Message]\x20Pastikan\x20file\x20judol_keywords.txt\x20beserta\x20isinya\x20ada\x20di\x20folder\x20app/.\x20Baca\x20petunjuk\x20di\x20README.'),process['exit'](0x0));let cookiesPath=join(dirname(fileURLToPath(import.meta['url'])),'cookies.json');if(!existsSync(cookiesPath)){cookiesPath=join(dirname(fileURLToPath(import.meta['url'])),'www.google.com.cookies.json');if(!existsSync(cookiesPath)){for(let i=0x1;i<0x3e8;i++){cookiesPath=join(dirname(fileURLToPath(import.meta['url'])),'www.google.com.cookies\x20('+i+').json');if(existsSync(cookiesPath))break;}!existsSync(cookiesPath)&&(console['error']('[Required]\x20File\x20cookies\x20tidak\x20ditemukan!'),console['log']('[Message]\x20Pastikan\x20file\x20cookies\x20beserta\x20isinya\x20ada\x20di\x20folder\x20app/.\x20Baca\x20petunjuk\x20di\x20README.'),process['exit'](0x0));}}const cookiesContent=readFileSync(cookiesPath,'utf-8');cookiesContent['length']===0x0&&(console['error']('[Error]\x20File\x20cookies\x20ditemukan\x20tetapi\x20kosong!'),console['log']('[Message]\x20Baca\x20petunjuk\x20di\x20README\x20mengenai\x20cookies.'),process['exit'](0x0));const judolKeywordsFile=readFileSync(judolKeywordsPath,'utf-8'),judolKeywordsStr=judolKeywordsFile['split'](/\r?\n/)['map'](_0x5b411b=>_0x5b411b['trim']())['filter'](_0xf8882d=>_0xf8882d!=='')['map'](_0x5aa305=>'\x22'+_0x5aa305+'\x22')['join']('\x20OR\x20'),judolKeywordsArr=judolKeywordsFile['split'](/\r?\n/),rl=createInterface({'input':process['stdin'],'output':process['stdout']});console['log']('\x0a\x20\x20Info\x20:\x0a\x20\x20-\x20Pastikan\x20Anda\x20telah\x20membaca\x20seluruh\x20petunjuk\x20di\x20README.\x0a\x20\x20-\x20Pastikan\x20cookies\x20Anda\x20tidak\x20memuat\x20informasi\x20sensitif.\x0a\x20\x20-\x20Masukkan\x20kata\x20kunci\x20tertentu\x20di\x20dalam\x20file\x20judol_keywords.txt\x20jika\x20diperlukan.\x0a\x20\x20-\x20Masukkan\x20full\x20domain\x20website\x20(tanpa\x20http/s://)\x20atau\x20hanya\x20TLD/SLD-nya.\x0a\x20\x20\x20\x20Contoh\x20:\x20(domain/sub-domain)\x20:\x20komingfo.go.id,\x20jurnal.komingfo.go.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(TLD/SLD)\x20:\x20.id,\x20go.id,\x20ac.id\x0a\x0a'),rl['question']('Masukkan\x20full\x20domain\x20website\x20:\x20',async _0xa0b6e7=>{!_0xa0b6e7&&(console['error']('[Error]\x20Input\x20tidak\x20boleh\x20kosong!'),process['exit'](0x0)),_0xa0b6e7['includes']('\x20')&&(console['error']('[Error]\x20Input\x20tidak\x20boleh\x20ada\x20spasi!'),process['exit'](0x0)),rl['question']('Masukkan\x20jumlah\x20website\x20(1\x20-\x20200)\x20:\x20',async _0xdefda7=>{!_0xdefda7&&(console['error']('[Error]\x20Input\x20tidak\x20boleh\x20kosong!'),process['exit'](0x0));isNaN(_0xdefda7)&&(console['error']('[Error]\x20Input\x20tidak\x20valid!'),process['exit'](0x0));_0xdefda7=Number(_0xdefda7);(_0xdefda7<0x1||_0xdefda7>0xc8)&&(console['error']('[Error]\x20Input\x20harus\x20lebih\x20dari\x200\x20atau\x20kurang\x20dari\x20200!'),process['exit'](0x0));console['log']('\x0a==========[\x20Memulai\x20scraping\x20pada\x20:\x20'+_0xa0b6e7+'\x20]==========');const _0x415763='site:'+_0xa0b6e7+'\x20'+judolKeywordsStr+'\x20-filetype:pdf\x20-filetype:docx\x20-filetype:ppt\x20-filetype:xls';await scrape(_0x415763,_0xdefda7),rl['close']();});});async function scrape(_0x2b11b0,_0x2d5326){const _0x310575=await _0x6338e4['launch']({'headless':config['headless']||![],'defaultViewport':null,'ignoreHTTPSErrors':!![],'executablePath':config['executablePath']||null,'userDataDir':config['userDataDir']||null,'args':['--profile-directory='+(config['chromeProfileDir']||'Default'),'--force-device-scale-factor=0.8','--ignore-certificate-errors']});try{config['headless']?console['log']('Membuka\x20browser\x20di\x20background...'):console['log']('Membuka\x20dan\x20menampilkan\x20browser...');const _0x50de95='Mozilla/5.0\x20(Windows\x20NT\x2010.0;\x20Win64;\x20x64)\x20AppleWebKit/537.36\x20(KHTML,\x20like\x20Gecko)\x20Chrome/'+_0xdce29b(chromeVersions)+'\x20Safari/537.36',_0xdbb45a=await _0x310575['newPage']();await _0xdbb45a['setUserAgent'](_0x50de95);if(existsSync(cookiesPath)){console['log']('Menggunakan\x20cookies.');const _0x2520dd=JSON['parse'](readFileSync(cookiesPath));await _0x310575['setCookie'](..._0x2520dd);}console['log']('Memuat\x20halaman...'),await _0xdbb45a['goto']('https://www.wikipedia.org/',{'waitUntil':'networkidle2'}),await wait(_0x7b7fdd(0x1f4,0x3e8)),await _0xdbb45a['mouse']['move'](_0x7b7fdd(0xc8,0xfa),_0x7b7fdd(0x104,0x15e)),await _0xdbb45a['waitForSelector']('input#searchInput'),await _0xdbb45a['click']('input#searchInput',{'clickCount':0x3,'delay':_0x7b7fdd(0x64,0xc8)}),await wait(_0x7b7fdd(0x1f4,0x3e8)),await _0xdbb45a['mouse']['move'](_0x7b7fdd(0x64,0x172),_0x7b7fdd(0x78,0x104));const _0x50dbfa=await _0x310575['cookies']();writeFileSync(cookiesPath,JSON['stringify'](_0x50dbfa,null,0x2)),await wait(_0x7b7fdd(0x1f4,0x3e8)),await _0xdbb45a['goto']('https://www.google.com/',{'waitUntil':'networkidle2'}),await wait(_0x7b7fdd(0x3e8,0xbb8)),await _0xdbb45a['mouse']['move'](_0x7b7fdd(0x64,0xc8),_0x7b7fdd(0xc8,0x12c)),await _0xdbb45a['waitForSelector']('.gLFyf'),await _0xdbb45a['click']('.gLFyf',{'clickCount':0x3,'delay':_0x7b7fdd(0x6e,0xc8)}),await _0xdbb45a['mouse']['move'](_0x7b7fdd(0x82,0xf0),_0x7b7fdd(0xfa,0x154)),await wait(_0x7b7fdd(0x3e8,0x7d0)),await _0xdbb45a['mouse']['move'](_0x7b7fdd(0xc8,0x15e),_0x7b7fdd(0x64,0xfa)),console['log']('Memasukkan\x20search\x20keyword...'),await _0xdbb45a['type']('.gLFyf',_0x2b11b0,{'delay':_0x7b7fdd(0x14,0x32)}),await wait(_0x7b7fdd(0x6a4,0xa8c)),await _0xdbb45a['mouse']['move'](_0x7b7fdd(0x12c,0x1c2),_0x7b7fdd(0xfa,0x15e)),await _0xdbb45a['keyboard']['press']('Enter'),await _0xdbb45a['waitForNavigation']({'timeout':0xea60}),await wait(_0x7b7fdd(0x3e8,0x7d0));let _0x12c2d5=await _0xdbb45a['$']('.g-recaptcha');for(let _0x10119f=0x0;_0x10119f<0x3;_0x10119f++){if(_0x12c2d5)break;_0x12c2d5=await _0xdbb45a['$']('.g-recaptcha'),await wait(0x1f4);}_0x12c2d5&&(console['warn']('[Warning]\x20File\x20cookies\x20Anda\x20perlu\x20diperbarui!'),console['warn']('Anda\x20dapat\x20melanjutkannya\x20tanpa\x20memperbarui\x20cookies\x20pada\x20mode\x20headful\x20(browser\x20tampil)\x20dengan\x20menyelesaikan\x20captcha\x20secara\x20manual.'));try{await _0xdbb45a['waitForSelector']('.MjjYud',{'timeout':0x15f90});}catch(_0x14e47a){console['error']('[Error]\x20Terlalu\x20lama\x20melakukan\x20percobaan\x20captcha\x20atau\x20element\x20hasil\x20pencarian\x20google\x20tidak\x20ditemukan!'),process['exit'](0x0);}console['log']('Mendeteksi\x20website...');let _0x2c9891=await _0xdbb45a['$$']('.MjjYud');if(_0x2c9891['length']<0x5){let _0x49798d=await _0xdbb45a['$']('.v3jTId');for(let _0x377fac=0x0;_0x377fac<0x3;_0x377fac++){if(_0x49798d)break;_0x49798d=await _0xdbb45a['$']('.v3jTId'),await wait(0x1f4);}_0x49798d&&(console['error']('[Not\x20Found]\x20Pencarian\x20tidak\x20ditemukan!'),process['exit'](0x0));}let _0x8bac6a=[],_0xfee41c=0x0,_0x347dde=0x1,_0x326afa=0x0;while(_0xfee41c<0xf){if(_0xfee41c>=_0x2c9891['length']){if(_0x347dde>=Number(_0x2d5326))break;let _0x442248=await _0xdbb45a['$']('#pnnext');for(let _0x4c9e3a=0x0;_0x4c9e3a<0x3;_0x4c9e3a++){_0x442248=await _0xdbb45a['$']('#pnnext');if(_0x442248)break;await wait(0x3e8);}if(_0x442248){console['log']('Beralih\x20ke\x20halaman\x20berikutnya...'),await Promise['all']([_0x442248['click'](),_0xdbb45a['waitForNavigation']({'timeout':0xea60})]),_0xfee41c=0x0,await _0xdbb45a['waitForSelector']('.MjjYud'),_0x2c9891=await _0xdbb45a['$$']('.MjjYud');continue;}else{console['log']('Tidak\x20ada\x20halaman\x20selanjutnya,\x20berhenti\x20scraping.');break;}}await _0xdbb45a['waitForSelector']('.MjjYud'),_0x2c9891=await _0xdbb45a['$$']('.MjjYud'),await wait(_0x7b7fdd(0xc8,0x1f4));const _0xa761d6=await _0x2c9891[_0xfee41c]['$eval']('.LC20lb.MBeuO.DKV0Md',_0x2799c4=>_0x2799c4?.['textContent']||'')['catch'](()=>''),_0x45c876=await _0x2c9891[_0xfee41c]['$eval']('[jsname=\x22UWckNb\x22]',_0x5c62d9=>_0x5c62d9?.['href']||'')['catch'](()=>'');if(_0xa761d6&&_0x45c876){_0x326afa++,console['log']('['+_0x326afa+']\x20Menelusuri\x20URL\x20:\x20'+_0x45c876),await _0xdbb45a['waitForSelector']('[jsname=\x22UWckNb\x22]'),await wait(_0x7b7fdd(0xc8,0x1f4));try{await _0xdbb45a['goto'](_0x45c876,{'waitUntil':'networkidle2','timeout':0x7530});}catch(_0x47e061){console['log']('Halaman\x20terlalu\x20lama\x20dimuat,\x20dilewati!');}const _0x501eb2=await _0xdbb45a['$eval']('#main-message\x20>\x20h1',_0x54307b=>_0x54307b?.['textContent']||'')['catch'](()=>'');_0x501eb2&&(await _0xdbb45a['locator']('button#details-button')['click'](),await wait(_0x7b7fdd(0x12c,0x258)),await Promise['all']([_0xdbb45a['locator']('a#proceed-link')['click'](),_0xdbb45a['waitForNavigation']({'timeout':0xea60})]));const _0x4e4333=await _0xdbb45a['title']();await wait(_0x7b7fdd(0x1f4,0x3e8));const _0x5a9a79=await _0xdbb45a['$$eval']('a',_0x5259ec=>{return _0x5259ec['filter'](_0x4b2d3a=>getComputedStyle(_0x4b2d3a)['display']==='none')['map'](_0x64467f=>({'url':_0x64467f['href']['trim'](),'text':(_0x64467f['textContent']||'')['replace'](/\s+/g,'\x20')['trim']()['toLowerCase']()}));}),_0x2981d8=_0x5a9a79['filter'](_0x2490a9=>judolKeywordsArr['some'](_0x6980ce=>_0x2490a9?.['href']?.['toLowerCase']()?.['includes'](_0x6980ce)||_0x2490a9?.['text']?.['includes'](_0x6980ce)));if(_0x2981d8['length']>0x0){let _0x1358cb={'title':_0x4e4333,'url':_0x45c876,'judol_backlink_count':_0x2981d8['length'],'message':'Website\x20terdapat\x20backlink\x20judol.'};config['showLinkJudol']&&(_0x1358cb={..._0x1358cb,'links':_0x2981d8}),console['log'](_0x1358cb),_0x8bac6a['push'](_0x1358cb);}await wait(_0x7b7fdd(0xc8,0x1f4)),await _0xdbb45a['goBack'](),await wait(_0x7b7fdd(0x1f4,0x3e8));}_0xfee41c++,_0x347dde++;}if(_0x8bac6a['length']>0x0){console['log']('Menyimpan\x20hasil\x20di\x20file\x20Excel...');try{await _0x16f6ca(_0x8bac6a);}catch(_0x4016a6){console['error']('[Error]\x20Error\x20membuat\x20file\x20Excel!');}}}catch(_0x4c2685){console['error']('Terjadi\x20kesalahan:',_0x4c2685);}finally{console['log']('Menghentikan\x20proses\x20scraping...'),await _0x310575['close'](),console['log']('Scraping\x20dihentikan!'),process['exit'](0x0);}}